/**
 * Class handling a single ship: manages creating the required markup
 * for the ship's info window, as well as displaying it when needed.
 * 
 * @module EVEShipInfo
 * @class EVEShipInfo_Ship
 * @constructor
 * @author Sebastian Mordziol <eve@aeonoftime.com>
 * @link http://eve.aeonoftime.com
 */
var EVEShipInfo_Ship=function(t,i){this.collection=t,this.data=i,this.namespace="shipinfo"+this.data.id,this.defaultTab="FrontView",this.rendered=!1,this.renderedTabs={},this.tabs={FrontView:"Front view",SideView:"Side view",Description:"Description",Attributes:"Attributes",Fittings:"Fittings"},console.log(this.data),this.InfoPopup=function(){if(this.IsTabEnabled(this.defaultTab)||(this.defaultTab="Description"),!this.rendered){this.RenderPopup()
var t=this
return void setTimeout(function(){t.Handle_PostRender()},160)}var i=this.Element("popup")
i.show()
var t=this
jQuery(document).on("mouseup."+this.namespace,function(s){i.is(s.target)||0!==i.has(s.target).length||t.ClosePopup()})},this.ClosePopup=function(){jQuery(document).off("mouseup."+this.namespace),this.Element("popup").hide()},this.RenderPopup=function(){console.log("Rendering the popup scaffold"),this.rendered=!0
var t=this,i='<div class="shipinfo-popup" id="'+this.ElementID("popup")+'" style="display:none;"><div class="shipinfo-header"><span class="shipinfo-shipname">'+this.data.name+'</span> <span class="shipinfo-race-group">'+this.data.raceName+" "+this.data.groupName+'</span></div><div class="shipinfo-content-wrapper" id="'+this.ElementID("content_wrapper")+'">'
jQuery.each(this.tabs,function(s,e){t.IsTabEnabled(s)&&(i+='<div class="shipinfo-tab shipinfo-'+s.toLowerCase()+'"><div class="shipinfo-tab-wrap" id="'+t.ElementID("tabcontent_"+s)+'">'+e+"</div></div>")}),i+='</div><div class="shipinfo-nav-wrapper"><div class="shipinfo-dismiss" id="'+this.ElementID("dismiss")+'">&times;</div><ul class="shipinfo-nav">',jQuery.each(this.tabs,function(s,e){t.IsTabEnabled(s)&&(i+='<li id="'+t.ElementID("tablink_"+s)+'" class="shipinfo-nav-item">'+e+"</li>")}),i+="</ul></div></div>",jQuery("body").append(i)},this.IsTabEnabled=function(t){var i="IsTabEnabled_"+t
return this[i].call(this)},this.IsTabEnabled_FrontView=function(){return!("undefined"==typeof this.data.screenshots.Front||!this.data.screenshots.Front.exists)},this.IsTabEnabled_SideView=function(){return!("undefined"==typeof this.data.screenshots.Side||!this.data.screenshots.Side.exists)},this.IsTabEnabled_Attributes=function(){return!0},this.IsTabEnabled_Description=function(){return!0},this.IsTabEnabled_Fittings=function(){return this.HasFittings()},this.ElementID=function(t){return this.namespace+"_"+t},this.Element=function(t){return jQuery("#"+this.ElementID(t))},this.Handle_PostRender=function(){console.log("Executing post render tasks")
var t=this,i=this.Element("popup"),s=i.width()
i.css({position:"absolute",left:"50%",top:jQuery(window).scrollTop()+50+"px","margin-left":-s/2,"margin-right":-s/2}),jQuery.each(this.tabs,function(i,s){tablink=t.Element("tablink_"+i).click(function(){t.Handle_ClickTab(i)})}),this.Element("dismiss").click(function(){t.ClosePopup()}),this.ActivateTab(this.defaultTab),this.InfoPopup()},this.ActivateTab=function(t){console.log("Activating tab "+t)
var i=this,s=this.Element("content_wrapper")
jQuery.each(this.tabs,function(e,a){linkEl=i.Element("tablink_"+e),tabEl=s.find(".shipinfo-"+e.toLowerCase()),e!=t?(tabEl.hide(),linkEl.removeClass("shipinfo-active"),s.removeClass(e.toLowerCase())):(tabEl.show(),linkEl.addClass("shipinfo-active"),s.addClass(e.toLowerCase()))}),this.RenderTab(t)},this.RenderTab=function(t){if("undefined"==typeof this.renderedTabs[t]){console.log("Rendering tab "+t),this.renderedTabs[t]=!0
var i="RenderTab_"+t,s=this[i].call(this)
this.Element("tabcontent_"+t).html(s)}},this.RenderTab_FrontView=function(){return'<img src="'+this.data.screenshots.Front.url+'"/>'},this.RenderTab_SideView=function(t){return'<img src="'+this.data.screenshots.Side.url+'"/>'},this.RenderTab_Description=function(t){return this.data.description},this.RenderTab_Attributes=function(t){launchers=this.TL("No launchers"),1==this.data.launcherHardpoints?launchers=this.TL("1 launcher"):this.data.launcherHardpoints>0&&(launchers=this.TL("X launchers").replace("%s",this.data.launcherHardpoints)),turrets=this.TL("No turrets"),1==this.data.turretHardpoints?turrets=this.TL("1 turret"):this.data.turretHardpoints>1&&(turrets=this.TL("X turrets").replace("%s",this.data.turretHardpoints)),drones=this.TL("None"),"0 M3"!=this.data.dronebaySize&&(drones=this.data.dronebaySize+" / "+this.data.droneBandwidth)
var i="<p>"+this.TL("Slots")+": "+this.data.hiSlots+" / "+this.data.medSlots+" / "+this.data.lowSlots+" - "+launchers+", "+turrets+"</p><p>"+this.TL("Cargo bay")+": "+this.data.cargobaySize+"</p><p>"+this.TL("Drones")+": "+drones+"</p><p>"+this.TL("Warp speed")+": "+this.data.warpSpeed+"<br/>"+this.TL("Max velocity")+": "+this.data.maxVelocity+"<br/>"+this.TL("Agility")+": "+this.data.agility+"</p><p>"+this.TL("Capacitor")+": "+this.TL("X power output").replace("%s",this.data.powerOutput)+" / "+this.TL("X capacitor capacity").replace("%s",this.data.capacitorCapacity)+" / "+this.TL("X recharge rate").replace("%s",this.data.capacitorRechargeRate)+"</p><p>"+this.TL("Shield")+": "+this.data.shieldHitpoints+" / "+this.TL("X recharge rate").replace("%s",this.data.shieldRechargeRate)+"<br/>"+this.TL("Armor")+": "+this.data.armorHitpoints+"<br/>"+this.TL("Structure")+": "+this.data.structureHitpoints+" / "+this.TL("X signature radius").replace("%s",this.data.signatureRadius)+"</p><p>"+this.TL("Max target range")+": "+this.data.maxTargetRange+" / "+this.TL("Max locked targets")+": "+this.data.maxLockedTargets+"<br/>"+this.TL("Scan speed")+": "+this.data.scanSpeed+" / "+this.TL("Scan resolution")+": "+this.data.scanResolution+"</p>"
return i},this.RenderTab_Fittings=function(){var t="",i=this.GetFittings()
return jQuery.each(i,function(i,s){t+=s.GetName()+"<br/><pre>"+s.ExportHTML()+"</pre>"}),t},this.Handle_ClickTab=function(t){this.ActivateTab(t)},this.TL=function(t){return EVEShipInfo_Translation.Translate(t)},this.GetFittings=function(){return EVEShipInfo.GetFittingsByShip(this)},this.GetID=function(){return this.data.id},this.GetName=function(){return this.data.name},this.HasFittings=function(){var t=this.GetFittings()
return t.length>0}}
